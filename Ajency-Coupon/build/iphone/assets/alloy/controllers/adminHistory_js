function __processArg(t,e){var i=null;return t&&(i=t[e]||null,delete t[e]),i}function Controller(){function t(){l.stickyFooter.animate({height:.1,duration:200}),O=!0}function e(){l.stickyFooter.animate({height:50,duration:200}),O=!1}function n(i){E=i.y,E>=0&&(E>=previousOffset?O||t():(console.log("Show"),console.log(O),O&&e()),previousOffset=E)}function r(){console.log("In Error Animate loader"),null!=m&&(m.image="/images/loader-"+F+".png"),F++,5===F&&(F=1)}function o(){console.log("In Success Animate loader"),null!=y&&(y.image="/images/loader-"+F+".png"),F++,5===F&&(F=1)}function a(){l.lbl_week.setColor("#83837C"),l.lbl_month.setColor("#83837C"),l.lbl_all.setColor("#83837C")}function s(t){a();var e=t.source.id;switch(k!=e&&z(e),e){case"tab_week":l.lbl_week.setColor("#F0C60A");break;case"tab_month":l.lbl_month.setColor("#F0C60A");break;case"tab_all":l.lbl_all.setColor("#F0C60A");break;default:console.log("Invalid selection")}}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="adminHistory",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var l=this,u={},c={};l.__views.adminHistory=Ti.UI.createView({id:"adminHistory"}),l.__views.adminHistory&&l.addTopLevelView(l.__views.adminHistory),l.__views.mainView=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.FILL,id:"mainView"}),l.__views.adminHistory.add(l.__views.mainView),l.__views.errorLabel=Ti.UI.createLabel({color:"#83837C",touchEnabled:!1,text:"Tap to Retry",id:"errorLabel",height:"0",width:"0",top:"0"}),l.__views.mainView.add(l.__views.errorLabel),l.__views.stickyFooter=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,bottom:0,backgroundColor:"#3B0B0B",id:"stickyFooter",height:"50",opacity:"0.9"}),l.__views.adminHistory.add(l.__views.stickyFooter),s?l.__views.stickyFooter.addEventListener("click",s):c["$.__views.stickyFooter!click!onTabSelected"]=!0,l.__views.tab_week=Ti.UI.createView({height:Ti.UI.FILL,id:"tab_week",width:"30%",left:"4%"}),l.__views.stickyFooter.add(l.__views.tab_week),l.__views.lbl_week=Ti.UI.createLabel({color:"#83837C",touchEnabled:!1,font:{fontFamily:"OpenSans-Regular",fontSize:18,fontWeight:"bold"},id:"lbl_week",text:"Week"}),l.__views.tab_week.add(l.__views.lbl_week),l.__views.__alloyId0=Ti.UI.createView({backgroundColor:"#F0C60A",left:"0",height:"60%",top:"20%",bottom:"20%",width:"0.3%",id:"__alloyId0"}),l.__views.stickyFooter.add(l.__views.__alloyId0),l.__views.tab_month=Ti.UI.createView({height:Ti.UI.FILL,id:"tab_month",width:"30%",left:"0"}),l.__views.stickyFooter.add(l.__views.tab_month),l.__views.lbl_month=Ti.UI.createLabel({color:"#83837C",touchEnabled:!1,font:{fontFamily:"OpenSans-Regular",fontSize:18,fontWeight:"bold"},id:"lbl_month",text:"Month"}),l.__views.tab_month.add(l.__views.lbl_month),l.__views.__alloyId1=Ti.UI.createView({backgroundColor:"#F0C60A",left:"0",height:"60%",top:"20%",bottom:"20%",width:"0.3%",id:"__alloyId1"}),l.__views.stickyFooter.add(l.__views.__alloyId1),l.__views.tab_all=Ti.UI.createView({height:Ti.UI.FILL,id:"tab_all",width:"30%",left:"0",right:"4%"}),l.__views.stickyFooter.add(l.__views.tab_all),l.__views.lbl_all=Ti.UI.createLabel({color:"#83837C",touchEnabled:!1,font:{fontFamily:"OpenSans-Regular",fontSize:18,fontWeight:"bold"},id:"lbl_all",text:"All"}),l.__views.tab_all.add(l.__views.lbl_all),u.destroy=function(){},_.extend(l,l.__views);var h,d=require("alloy/moment"),f=arguments[0]||{};f.userid?h={userId:f.userid}:f.productid&&(h={productId:f.productid});var p,m,g,y,v,w=innerView=leftView=rightView=imageView=transactionScroll=localAnimateObject=null,T=productNameLabel=dateLabel=priceLabel=null,I=innerErrorView=null,b=innerAnimateView=null,A=!1,S=0,L=0,E=previousOffset=0,O=!1,k="tab_week",x=[],C=d().isoWeekday(1).format("L"),N=d().isoWeekday(7).format("L"),D=d().startOf("month").format("L"),P=d().endOf("month").format("L"),U=require("/localStorage"),M=require("/networkCheck"),F=1,R=function(t,e,i){e||(e=100);var n,r,o,a=0,s=!1===i?0:e;return function(){function l(){n&&(n=clearTimeout(n)),t.apply(o,r),a=u}var u=+new Date,c=u-a-s;r=arguments,o=this,c>e?l():n||!1===i||(n=setTimeout(l,e))}},V=function(){I=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:70,backgroundColor:"transparent"}),innerErrorView=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:69.2}),p=Ti.UI.createLabel({left:"35%",top:20,text:"Tap to Retry",font:{fontFamily:"OpenSans-Regular",fontSize:15}}),T=Ti.UI.createView({width:Ti.UI.FILL,height:.8,backgroundColor:"#F0C60A"}),I.addEventListener("click",function(){0==M.getNetworkStatus()?alert("No Internet Connection"):(p.height=0,innerErrorView.remove(p),m=Ti.UI.createImageView({left:"45%",top:"15",height:40,width:48}),innerErrorView.add(m),g=setInterval(r,200),B(),W(k))}),innerErrorView.add(p),I.add(innerErrorView),I.add(T);var t;t=1e3,setTimeout(function(){l.mainView.add(I)},t)},Y=function(){null!=I&&(clearInterval(g),l.mainView.remove(I))},B=function(){b=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:70,backgroundColor:"transparent"}),innerAnimateView=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:69.2}),T=Ti.UI.createView({width:Ti.UI.FILL,height:.8,backgroundColor:"#F0C60A"}),y=Ti.UI.createImageView({left:"45%",top:"15",height:40,width:48}),innerAnimateView.add(y),v=setInterval(o,200),b.add(innerAnimateView),b.add(T);var t;t=1e3,setTimeout(function(){l.mainView.add(b)},t)},H=function(){null!=b&&(clearInterval(v),l.mainView.remove(b))},G=function(t){if(console.log("Size:"),console.log(_.size(t)),_.size(t)>=1){A?0!=S?(console.log("connection view not present"),V()):S=1:0!=L?(console.log("Loader not present"),B()):L=1,transactionScroll=Ti.UI.createScrollView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.FILL,scrollType:"vertical",disableBounce:!0}),transactionScroll.addEventListener("scroll",R(n,1e3));for(var e=0;len=_.size(t),len>e;e++){var i=d(t[e].updated_at);w=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:70,backgroundColor:"transparent"}),innerView=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:69.2}),leftView=Ti.UI.createView({layout:"vertical",left:"10%",width:"70%",height:Ti.UI.FILL}),productNameLabel=Ti.UI.createLabel({touchEnabled:!1,top:"10%",left:0,text:t[e].productName,color:"#3B0B0B",font:{fontFamily:"OpenSans-Regular",fontSize:20}}),"Credit"===t[e].productName&&(productNameLabel.setColor("#FF0000"),productNameLabel.font={fontFamily:"OpenSans-Regular",fontSize:20,fontWeight:"bold"});var r;f.userid?r=i.format("L"):f.productid&&(r=i.format("L")+"  Qty: "+t[e].quantity),dateLabel=Ti.UI.createLabel({touchEnabled:!1,top:"10%",left:0,text:r,color:"#A4A4A4",font:{fontFamily:"OpenSans-Regular",fontSize:13}}),leftView.add(productNameLabel),leftView.add(dateLabel),rightView=Ti.UI.createView({layout:"horizontal",left:0,width:"20%",height:Ti.UI.FILL}),imageView=Ti.UI.createImageView({image:U.getCurrencyUrl(),width:15,height:15,top:"20%",right:0});var o;o=parseInt(t[e].productPrice),priceLabel=Ti.UI.createLabel({touchEnabled:!1,top:"10%",right:0,text:o,color:"#3B0B0B",font:{fontFamily:"OpenSans-Regular",fontSize:20}}),rightView.add(imageView),rightView.add(priceLabel),innerView.add(leftView),innerView.add(rightView),w.add(innerView),T=Ti.UI.createView({width:Ti.UI.FILL,height:.8,backgroundColor:"#F0C60A"}),w.add(T),transactionScroll.add(w),w=innerView=leftView=rightView=imageView=null,T=productNameLabel=dateLabel=priceLabel=null}var a;a=1e3,setTimeout(function(){null!=localAnimateObject&&(localAnimateObject.height=0,localAnimateObject.width=0,localAnimateObject.top=0,l.mainView.remove(localAnimateObject)),l.mainView.add(transactionScroll),setTimeout(function(){},100),setTimeout(function(){0!=L&&H()},1e3)},a)}},z=function(t){console.log("Sort transactions"),console.log(t),0===x.length?alert("No records to fetch"):(null!=transactionScroll&&(console.log("transaction scroll not null"),l.mainView.remove(transactionScroll),l.mainView.removeAllChildren(),transactionScroll=null),console.log("Removing Children of main views"),console.log(l.mainView.children.length),setTimeout(function(){switch(t){case"tab_week":var e=x.filter(function(t){var e=d(t.updated_at).format("L");return e>=C&&N>=e}),i={data:e,name:f.name};Ti.App.fireEvent("app:adminStaticView",i),G(e),k=t;break;case"tab_month":var n=x.filter(function(t){var e=d(t.updated_at).format("L");return e>=D&&P>=e}),i={data:n,name:f.name};Ti.App.fireEvent("app:adminStaticView",i),G(n),k=t;break;case"tab_all":var i={data:x,name:f.name};Ti.App.fireEvent("app:adminStaticView",i),G(x),k=t}},200))};l.lbl_week.setColor("#F0C60A");var W=function(t){Cloud.Objects.query({classname:"testItems",limit:1e3,where:h},function(e){if(e.success){for(Y(),i=0;len=e.testItems.length,len>i;i++)x.push(e.testItems[i]);z(t),H(),A=!1}else H(),V(),A=!0,z(t)})};Titanium.Network.networkType===Titanium.Network.NETWORK_NONE?(V(),L=1,A=!0,z("tab_week")):(B(),W(k)),c["$.__views.stickyFooter!click!onTabSelected"]&&l.__views.stickyFooter.addEventListener("click",s),_.extend(l,u)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;