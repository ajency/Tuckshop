function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(){null!=g&&(g.image="/images/loaderlogin-"+I+".png"),I++,5===I&&(I=1)}function t(){Alloy.isTablet?(rowHeight=150,h=12.6,f=30,p=1.8):(rowHeight=90,h=21,f=18,p=1.08)}function i(){var e=dbOperations.getOrganizationRow(w.getOrganizationId()),t=e[0].organizationPendingChannel;Cloud.PushNotifications.subscribeToken({device_token:deviceToken,channel:t,type:"ios"},function(e){e.success?(l.Globals.populateLeftMenu(),v.fetchCategories("home")):(b(),clearInterval(c),d="subscribeToPendingChannel",L())})}function n(){Cloud.Users.update({custom_fields:{last_mail_date:moment().format(),device_token:deviceToken}},function(e){if(e.success){var t=e.users[0];dbOperations.updateLastMailDate(t.id,t.custom_fields.last_mail_date),dbOperations.updateUserType(t.id,t.admin),t.hasOwnProperty("role")?(console.log("user has a role in home"),dbOperations.updateUserRole(t.id,t.role)):dbOperations.updateUserRole(t.id,"consumer"),"cook"===dbOperations.getUserRole(w.getLastLoggedInUserId())?(console.log("cook id"),i()):v.fetchCategories("home")}else{b(),clearInterval(c);var n=Ti.UI.createNotification({message:"Please Login again to continue",duration:Ti.UI.NOTIFICATION_DURATION_LONG});n.show(),l.Globals.navigatedFromAllProducts=!0,Alloy.createController("index",{}).getView().open()}})}function r(){Cloud.Objects.query({classname:"organization",limit:1e3,where:{organizationId:w.getOrganizationId()}},function(e){e.success?(dbOperations.saveOrganizationRow(e.organization),n()):(b(),clearInterval(c),d="organizationData",L())})}function o(e){var t=0;_.each(e,function(e){t+=parseFloat(e.productPrice)}),t=t.toFixed(2),Ti.App.fireEvent("Calculate",{value:t})}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="home",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var a=this,s={};a.__views.categoryView=Ti.UI.createScrollView({top:"0%",width:Ti.UI.FILL,height:Ti.UI.FILL,showHorizontalScrollIndicator:!1,showVerticalScrollIndicator:!0,scrollType:"vertical",contentHeight:"auto",layout:"vertical",id:"categoryView",scrollingEnabled:"true"}),a.__views.categoryView&&a.addTopLevelView(a.__views.categoryView),s.destroy=function(){},_.extend(a,a.__views);var l=require("alloy");require("animation"),require("platformSupport"),arguments[0]||{};var d,c,u,h,f,p,g,m,w=require("/localStorage"),y=require("/networkCheck"),v=require("/fetchCloudProducts"),I=1;t();var T=function(){g=Ti.UI.createImageView({height:96,width:96,top:"45%"}),a.categoryView.add(g)},b=function(){null!=g&&a.categoryView.remove(g)},L=function(){m=Ti.UI.createLabel({height:"12%",width:"30%",top:"45%",text:"Tap to Retry",font:{fontFamily:"OpenSans-Regular",fontSize:15}}),a.categoryView.add(m)};null!=m&&m.addEventListener("click",function(){0==y.getNetworkStatus()?alert("No Internet Connection"):"fetchAllTransactions"===d?V():(T(),c=setInterval(e,250),A(),"organizationData"===d?r():"subscribeToPendingChannel"===d?i():"fetchCategories"===d?v.fetchCategories("home"):"fetchCloudProducts"===d?v.fetchCloudProducts("home"):"transactionsOnProductIds"===d?v.transactionsOnProductIds("home"):"transactionsOnProductIdsGreaterThanThousand"===d&&v.transactionsOnProductIdsGreaterThanThousand("home"))});var A=function(){null!=m&&a.categoryView.remove(m)},S=function(e){return e%2?!0:!1},U=function(){var e=Ti.UI.createView({width:Ti.UI.FILL,height:rowHeight,top:h});return e},C=function(e,t){var i=Ti.UI.createView({touchEnabled:!0,layout:"vertical",width:"50%",height:"100%",id:t.categoryId});0===e?i.setLeft(0):i.setRight(0);var n=Ti.UI.createImageView({touchEnabled:!1,height:"60%",width:"30%",align:"center",image:t.photo.urls.small_240}),r=Ti.UI.createLabel({touchEnabled:!1,height:"40%",width:"100%",textAlign:"center",color:"#000000",font:{fontFamily:"OpenSans-Regular",fontSize:20},text:t.categoryName});return i.add(n),i.add(r),i.addEventListener("click",function(e){var t={id:e.source.id};l.Globals.navigatedView=t.id,Ti.App.fireEvent("app:addViewToMidContainer",t),t=null}),i},E=function(){var e=Ti.UI.createView({layout:"vertical",backgroundColor:"#F0C60A",height:"100%",width:"0.3%",align:"center"});return e},O=function(){var e=Ti.UI.createView({backgroundColor:"#F0C60A",height:p,width:"85%",top:f});return e},k=function(){var e=Ti.UI.createView({height:f,width:"100%",top:"0%"});return e},x=function(e){for(var t,i,n=null,r=0;len=e.length,len>r;r++){var o=r+1;S(o)?(t=U(),1===o?(i=C(0,e[r]),t.add(i),1===len&&a.categoryView.add(t)):(a.categoryView.add(O()),i=C(0,e[r]),t.add(i),o===len&&a.categoryView.add(t))):(t.add(E()),n=C(1,e[r]),t.add(n),a.categoryView.add(t),t=null),i=n=null}a.categoryView.add(k())},V=function(){T(),c=setInterval(e,250),A(),Cloud.Objects.query({classname:"testItems",limit:1e3,where:{userId:w.getUserId()}},function(e){e.success?(b(),clearInterval(c),dbOperations.saveTransactionRows(e.testItems),o(dbOperations.getAllTransactionRows(w.getLastLoggedInUserId())),u=w.getAllCategories(),x(u)):(b(),clearInterval(c),d="fetchAllTransactions",L())})};Ti.include("/data/categoriesData.js"),Ti.App.fireEvent("Display",{displayValue:w.getDisplayName()}),Ti.App.addEventListener("errorOnHome",function(e){b(),clearInterval(c),d=e.name,L()}),Ti.App.addEventListener("successOnHome",function(){console.log("Success on home called"),b(),null!=c&&clearInterval(c),a.categoryView.removeAllChildren(),u=w.getAllCategories(),x(u)}),Ti.App.addEventListener("refreshCategories",function(e){e.cancelBubble=!0,a.categoryView.removeAllChildren(),x(u)}),dbOperations.checkTransactionsPresentForUser(w.getLastLoggedInUserId())?(o(dbOperations.getAllTransactionRows(w.getLastLoggedInUserId())),Titanium.App.version>="4.0"&&!w.getAllCategories()&&!l.Globals.pushNotificationReceived?(T(),c=setInterval(e,250),A(),enteredEmailValue=w.getUserName().split("@"),"ajency.in"===enteredEmailValue[1]?(console.log("Entered is ajency mail"),w.saveOrganizationId(1)):"ascotwm.com"===enteredEmailValue[1]&&w.saveOrganizationId(2),dbOperations.setOrganizationId(w.getLastLoggedInUserId(),w.getOrganizationId()),dbOperations.updateMailStatus(w.getLastLoggedInUserId(),1,"daily"),null!=dbOperations.getSessionId(w.getLastLoggedInUserId())&&(Cloud.sessionId=w.getSessionId()),r()):l.Globals.pushNotificationReceived?l.Globals.pushNotificationReceived&&(a.categoryView.removeAllChildren(),T(),c=setInterval(e,250),A()):(console.log("No push received"),u=w.getAllCategories(),x(u))):V(),_.extend(a,s)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;