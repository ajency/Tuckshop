function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(){r.animateObject.image="/images/loaderlogin-"+m+".png",m++,5===m&&(m=1)}function t(){r.usernameTextfield.blur(),r.passwordTextfield.blur(),I(),u=setInterval(e,200),T(),"ajency.in"===d[1]?f.saveOrganizationId(1):"ascotwm.com"===d[1]&&f.saveOrganizationId(2),Cloud.Users.create({username:r.usernameTextfield.value,password:r.passwordTextfield.value,password_confirmation:r.passwordTextfield.value,custom_fields:{credited_date_at:h().format(),organizationId:f.getOrganizationId(),last_mail_date:h().format(),device_token:deviceToken}},function(e){if(e.success){var t=e.users[0];dbOperations.insertRow(t.id,r.usernameTextfield.value,!1,e.meta.session_id,t.custom_fields.credited_date_at,t.custom_fields.organizationId,1,"daily",t.custom_fields.last_mail_date,t.admin,"consumer"),f.saveUserId(t),f.saveUserName(r.usernameTextfield.value),f.saveDisplayName(d[0]),dbOperations.checkOrganizationPresent(f.getOrganizationId())?A():a()}else v(),y(),clearInterval(u),alert(400==e.code?"Username is already taken":"Could not connect to server. Try again ")})}function i(){if(""!=r.usernameTextfield.value.trim()&&""!=r.passwordTextfield.value.trim())if(d=r.usernameTextfield.value.split("@"),n(r.usernameTextfield.value))if("ajency.in"===d[1]||"ascotwm.com"===d[1])if(Titanium.Network.networkType===Titanium.Network.NETWORK_NONE)alert("No Internet Connection");else if(f.getOrganizationId())if(dbOperations.checkOrganizationPresent(f.getOrganizationId())){var e=dbOperations.getOrganizationRow(f.getOrganizationId());e[0].domainName===d[1]?t():alert("Sorry your organization is not registered")}else t();else t();else alert("Sorry your organization is not registered");else alert("Please enter a valid email");else alert("All fields are required")}function a(){Cloud.Objects.query({classname:"organization",limit:1e3,where:{organizationId:f.getOrganizationId()}},function(e){e.success?(dbOperations.saveOrganizationRow(e.organization),A()):(v(),clearInterval(u),c="organizationData",b())})}function o(){var e=dbOperations.getOrganizationRow(f.getOrganizationId()),t=e[0].organizationPushChannel;Cloud.PushNotifications.subscribeToken({device_token:deviceToken,channel:t,type:"ios"},function(e){if(e.success){var t=require("/fetchCloudProducts");t.fetchCategories("index")}else v(),clearInterval(u),c="subscribeToChannel",b(),console.log("SUBSCRIBE CHANNEL")})}function n(e){var t=e,i=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return testresults=i.test(t)?!0:!1}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="register",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var r=this,l={},s={};r.__views.registerWindow=Ti.UI.createWindow({backgroundColor:"transparent",opacity:1,width:Ti.UI.FILL,height:Ti.UI.FILL,layout:"vertical",navBarHidden:!0,backgroundImage:"/background.jpg",id:"registerWindow"}),r.__views.registerWindow&&r.addTopLevelView(r.__views.registerWindow),r.__views.__alloyId32=Ti.UI.createView({layout:"vertical",top:0,height:"80%",id:"__alloyId32"}),r.__views.registerWindow.add(r.__views.__alloyId32),r.__views.__alloyId33=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,top:"5%",id:"__alloyId33"}),r.__views.__alloyId32.add(r.__views.__alloyId33),r.__views.__alloyId34=Ti.UI.createImageView({image:"/images/tuckshopLogo.png",width:"45%",height:"29%",id:"__alloyId34"}),r.__views.__alloyId33.add(r.__views.__alloyId34),r.__views.__alloyId35=Ti.UI.createLabel({font:{fontFamily:"OpenSans-Regular",fontSize:22,fontWeight:"bold"},textAlign:"center",width:Ti.UI.FILL,color:"#3B0B0B",text:"Create my account",top:"5.5%",id:"__alloyId35"}),r.__views.__alloyId33.add(r.__views.__alloyId35),r.__views.usernameTextfield=Ti.UI.createTextField({backgroundColor:"#FFF",color:"#222",borderWidth:1,borderColor:"#F0C60A",height:"11%",font:{fontFamily:"OpenSans-Regular",fontSize:18},textAlign:"center",width:"90%",left:"5%",right:"5%",keyboardType:Ti.UI.KEYBOARD_EMAIL,borderStyle:Titanium.UI.INPUT_BORDERSTYLE_NONE,top:"4%",id:"usernameTextfield",hintText:"Organization email id"}),r.__views.__alloyId33.add(r.__views.usernameTextfield),r.__views.passwordTextfield=Ti.UI.createTextField({backgroundColor:"#FFF",color:"#222",borderWidth:1,borderColor:"#F0C60A",height:"11%",font:{fontFamily:"OpenSans-Regular",fontSize:18},textAlign:"center",width:"90%",left:"5%",right:"5%",keyboardType:Titanium.UI.KEYBOARD_NUMBER_PAD,borderStyle:Titanium.UI.INPUT_BORDERSTYLE_NONE,top:"2%",id:"passwordTextfield",hintText:"Password",maxLength:"4"}),r.__views.__alloyId33.add(r.__views.passwordTextfield),r.__views.animateObject=Ti.UI.createImageView({id:"animateObject",height:"0",width:"0",top:"0"}),r.__views.__alloyId33.add(r.__views.animateObject),r.__views.registerErrorLabel=Ti.UI.createLabel({font:{fontFamily:"OpenSans-Regular",fontSize:15,fontWeight:"bold"},text:"Tap to Retry",id:"registerErrorLabel",height:"0",width:"0",top:"0"}),r.__views.__alloyId33.add(r.__views.registerErrorLabel),r.__views.signUpButton=Ti.UI.createButton({width:"90%",left:"5%",right:"5%",color:"#3B0B0B",backgroundColor:"#F0C60A",title:"Sign up",height:"11%",font:{fontFamily:"OpenSans-Regular",fontSize:20,fontWeight:"bold"},style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,id:"signUpButton",top:"2%"}),r.__views.__alloyId33.add(r.__views.signUpButton),i?r.__views.signUpButton.addEventListener("click",i):s["$.__views.signUpButton!click!registerClicked"]=!0,r.__views.backIcon=Ti.UI.createButton({color:"#3B0B0B",id:"backIcon",top:"2%",left:"42.5%",backgroundImage:"/images/left_arrow.png",height:"10%",width:"15%"}),r.__views.__alloyId33.add(r.__views.backIcon),g?r.__views.backIcon.addEventListener("click",g):s["$.__views.backIcon!click!closeWindow"]=!0,r.__views.__alloyId36=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,bottom:0,height:"20%",id:"__alloyId36"}),r.__views.registerWindow.add(r.__views.__alloyId36),r.__views.__alloyId37=Ti.UI.createImageView({width:Ti.UI.FILL,height:Ti.UI.FILL,image:"/images/footer.png",id:"__alloyId37"}),r.__views.__alloyId36.add(r.__views.__alloyId37),l.destroy=function(){},_.extend(r,r.__views),arguments[0]||{},require("platformSupport"),require("animation");var d,c,u,h=require("alloy/moment"),g=function(){var e=Alloy.createController("index",{}).getView();e.open()},f=require("/localStorage"),p=require("/networkCheck"),w=require("/fetchCloudProducts"),m=1,I=function(){r.animateObject.height=96,r.animateObject.width=96},v=function(){r.animateObject.height=0,r.animateObject.width=0},y=function(){r.passwordTextfield.visible=!0,r.usernameTextfield.visible=!0,r.signUpButton.visible=!0,r.backIcon.visible=!0},T=function(){r.passwordTextfield.visible=!1,r.usernameTextfield.visible=!1,r.signUpButton.visible=!1,r.backIcon.visible=!1},b=function(){r.registerErrorLabel.height="15%",r.registerErrorLabel.width="30%"};r.registerErrorLabel.addEventListener("click",function(){0==p.getNetworkStatus()?alert("No Internet Connection"):(I(),u=setInterval(e,200),L(),"autoLogin"===c?autoLogin():"organizationData"===c?a():"updateCreditAmount"===c?A():"subscribeToChannel"===c?o():"fetchCategories"===c?w.fetchCategories("index"):"fetchCloudProducts"===c?w.fetchCloudProducts("index"):"transactionsOnProductIds"===c?w.transactionsOnProductIds("index"):"transactionsOnProductIdsGreaterThanThousand"===c&&w.transactionsOnProductIdsGreaterThanThousand("index"))});var L=function(){r.registerErrorLabel.height=0,r.registerErrorLabel.width=0};Ti.App.addEventListener("errorOnRegister",function(e){console.log("Error event fired register"),v(),clearInterval(u),c=e.name,b()});var A=function(){Cloud.Objects.create({classname:"testItems",fields:{productName:"Credit",productPrice:500,productId:1010,userId:f.getUserId()}},function(e){if(e.success)if(e.testItems[0],f.getAllProducts()){var t=Alloy.createController("index",{}).getView();t.open()}else o();else v(),clearInterval(u),c="updateCreditAmount",b(),console.log("REGSITER USER")})};s["$.__views.signUpButton!click!registerClicked"]&&r.__views.signUpButton.addEventListener("click",i),s["$.__views.backIcon!click!closeWindow"]&&r.__views.backIcon.addEventListener("click",g),_.extend(r,l)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;