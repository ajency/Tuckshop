function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(){s.stickyFooter.animate({height:.1,duration:200}),U=!0}function t(){s.stickyFooter.animate({height:50,duration:200}),U=!1}function i(i){A=i.y,A>=0&&(A>=previousOffset?U||e():(console.log("Show"),console.log(U),U&&t()),previousOffset=A)}function a(){console.log("In Error Animate loader"),null!=h&&(h.image="/images/loader-"+P+".png"),P++,5===P&&(P=1)}function o(){console.log("In Success Animate loader"),null!=w&&(w.image="/images/loader-"+P+".png"),P++,5===P&&(P=1)}function n(){s.lbl_week.setColor("#83837C"),s.lbl_month.setColor("#83837C"),s.lbl_all.setColor("#83837C")}function r(e){n();var t=e.source.id;switch(k!=t&&Y(t),t){case"tab_week":s.lbl_week.setColor("#F0C60A");break;case"tab_month":s.lbl_month.setColor("#F0C60A");break;case"tab_all":s.lbl_all.setColor("#F0C60A");break;default:console.log("Invalid selection")}}function l(e){var t=0;_.each(e,function(e){t+=parseFloat(e.productPrice)}),t=t.toFixed(2),Ti.App.fireEvent("Calculate",{value:t})}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="transactionHistory",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var s=this,d={},c={};s.__views.transactionHistory=Ti.UI.createView({id:"transactionHistory"}),s.__views.transactionHistory&&s.addTopLevelView(s.__views.transactionHistory),s.__views.mainView=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.FILL,id:"mainView"}),s.__views.transactionHistory.add(s.__views.mainView),s.__views.errorLabel=Ti.UI.createLabel({color:"#83837C",touchEnabled:!1,text:"Tap to Retry",id:"errorLabel",height:"0",width:"0",top:"0"}),s.__views.mainView.add(s.__views.errorLabel),s.__views.stickyFooter=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,bottom:0,backgroundColor:"#3B0B0B",id:"stickyFooter",height:"50",opacity:"0.9"}),s.__views.transactionHistory.add(s.__views.stickyFooter),r?s.__views.stickyFooter.addEventListener("click",r):c["$.__views.stickyFooter!click!onTabSelected"]=!0,s.__views.tab_week=Ti.UI.createView({height:Ti.UI.FILL,id:"tab_week",width:"30%",left:"4%"}),s.__views.stickyFooter.add(s.__views.tab_week),s.__views.lbl_week=Ti.UI.createLabel({color:"#83837C",touchEnabled:!1,font:{fontFamily:"OpenSans-Regular",fontSize:18,fontWeight:"bold"},id:"lbl_week",text:"Week"}),s.__views.tab_week.add(s.__views.lbl_week),s.__views.__alloyId38=Ti.UI.createView({backgroundColor:"#F0C60A",left:"0",height:"60%",top:"20%",bottom:"20%",width:"0.3%",id:"__alloyId38"}),s.__views.stickyFooter.add(s.__views.__alloyId38),s.__views.tab_month=Ti.UI.createView({height:Ti.UI.FILL,id:"tab_month",width:"30%",left:"0"}),s.__views.stickyFooter.add(s.__views.tab_month),s.__views.lbl_month=Ti.UI.createLabel({color:"#83837C",touchEnabled:!1,font:{fontFamily:"OpenSans-Regular",fontSize:18,fontWeight:"bold"},id:"lbl_month",text:"Month"}),s.__views.tab_month.add(s.__views.lbl_month),s.__views.__alloyId39=Ti.UI.createView({backgroundColor:"#F0C60A",left:"0",height:"60%",top:"20%",bottom:"20%",width:"0.3%",id:"__alloyId39"}),s.__views.stickyFooter.add(s.__views.__alloyId39),s.__views.tab_all=Ti.UI.createView({height:Ti.UI.FILL,id:"tab_all",width:"30%",left:"0",right:"4%"}),s.__views.stickyFooter.add(s.__views.tab_all),s.__views.lbl_all=Ti.UI.createLabel({color:"#83837C",touchEnabled:!1,font:{fontFamily:"OpenSans-Regular",fontSize:18,fontWeight:"bold"},id:"lbl_all",text:"All"}),s.__views.tab_all.add(s.__views.lbl_all),d.destroy=function(){},_.extend(s,s.__views);var u,h,g,w,f,p=require("alloy/moment"),m=innerView=leftView=rightView=imageView=transactionScroll=localAnimateObject=null,v=productNameLabel=dateLabel=priceLabel=null,I=innerErrorView=null,y=innerAnimateView=null,T=!1,b=0,L=0,A=previousOffset=0,U=!1,k="tab_week",S=null,C=p().isoWeekday(1).format("L"),V=p().isoWeekday(7).format("L"),O=p().startOf("month").format("L"),E=p().endOf("month").format("L"),x=require("/localStorage"),F=require("/networkCheck"),P=1,R=function(e,t,i){t||(t=100);var a,o,n,r=0,l=!1===i?0:t;return function(){function s(){a&&(a=clearTimeout(a)),e.apply(n,o),r=d}var d=+new Date,c=d-r-l;o=arguments,n=this,c>t?s():a||!1===i||(a=setTimeout(s,t))}},B=function(){I=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:70,backgroundColor:"transparent"}),innerErrorView=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:69.2}),u=Ti.UI.createLabel({left:"35%",top:20,text:"Tap to Retry",font:{fontFamily:"OpenSans-Regular",fontSize:15}}),v=Ti.UI.createView({width:Ti.UI.FILL,height:.8,backgroundColor:"#F0C60A"}),I.addEventListener("click",function(){0==F.getNetworkStatus()?alert("No Internet Connection"):(u.height=0,innerErrorView.remove(u),h=Ti.UI.createImageView({left:"45%",top:"15",height:40,width:48}),innerErrorView.add(h),g=setInterval(a,200),M(),H(k))}),innerErrorView.add(u),I.add(innerErrorView),I.add(v);var e;e=1e3,setTimeout(function(){s.mainView.add(I)},e)},N=function(){null!=I&&(clearInterval(g),s.mainView.remove(I))},M=function(){y=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:70,backgroundColor:"transparent"}),innerAnimateView=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:69.2}),v=Ti.UI.createView({width:Ti.UI.FILL,height:.8,backgroundColor:"#F0C60A"}),w=Ti.UI.createImageView({left:"45%",top:"15",height:40,width:48}),innerAnimateView.add(w),f=setInterval(o,200),y.add(innerAnimateView),y.add(v);var e;e=1e3,setTimeout(function(){s.mainView.add(y)},e)},D=function(){null!=y&&(clearInterval(f),s.mainView.remove(y))},z=function(e){if(console.log("Size:"),console.log(_.size(e)),_.size(e)>=1){T?0!=b?(console.log("connection view not present"),B()):b=1:0!=L?(console.log("Loader not present"),M()):L=1,transactionScroll=Ti.UI.createScrollView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.FILL,scrollType:"vertical",disableBounce:!0}),transactionScroll.addEventListener("scroll",R(i,1e3));for(var t=0;len=_.size(e),len>t;t++){var a=p(e[t].updated_at);m=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:70,backgroundColor:"transparent"}),innerView=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:69.2}),leftView=Ti.UI.createView({layout:"vertical",left:"10%",width:"70%",height:Ti.UI.FILL}),productNameLabel=Ti.UI.createLabel({touchEnabled:!1,top:"10%",left:0,text:e[t].productName,color:"#3B0B0B",font:{fontFamily:"OpenSans-Regular",fontSize:20}}),"Credit"===e[t].productName&&(productNameLabel.setColor("#FF0000"),productNameLabel.font={fontFamily:"OpenSans-Regular",fontSize:20,fontWeight:"bold"}),dateLabel=Ti.UI.createLabel({touchEnabled:!1,top:"10%",left:0,text:a.format("L"),color:"#A4A4A4",font:{fontFamily:"OpenSans-Regular",fontSize:13}}),leftView.add(productNameLabel),leftView.add(dateLabel),rightView=Ti.UI.createView({layout:"horizontal",left:0,width:"20%",height:Ti.UI.FILL}),imageView=Ti.UI.createImageView({image:x.getCurrencyUrl(),width:15,height:15,top:"20%",right:0});var o;o=parseInt(e[t].productPrice),priceLabel=Ti.UI.createLabel({touchEnabled:!1,top:"10%",right:0,text:o,color:"#3B0B0B",font:{fontFamily:"OpenSans-Regular",fontSize:20}}),rightView.add(imageView),rightView.add(priceLabel),innerView.add(leftView),innerView.add(rightView),m.add(innerView),v=Ti.UI.createView({width:Ti.UI.FILL,height:.8,backgroundColor:"#F0C60A"}),m.add(v),transactionScroll.add(m),m=innerView=leftView=rightView=imageView=null,v=productNameLabel=dateLabel=priceLabel=null}var n;n=1e3,setTimeout(function(){null!=localAnimateObject&&(localAnimateObject.height=0,localAnimateObject.width=0,localAnimateObject.top=0,s.mainView.remove(localAnimateObject)),s.mainView.add(transactionScroll),setTimeout(function(){},100),setTimeout(function(){0!=L&&D()},1e3)},n)}console.log("Removing Children of main views"),console.log(s.mainView.children.length)},Y=function(e){dbOperations.checkTransactionsPresentForUser(x.getLastLoggedInUserId())?(S=dbOperations.getAllTransactionRows(x.getLastLoggedInUserId()),null!=transactionScroll&&(console.log("transaction scroll not null"),s.mainView.remove(transactionScroll),s.mainView.removeAllChildren(),transactionScroll=null),console.log("Removing Children of main views"),console.log(s.mainView.children.length),setTimeout(function(){switch(e){case"tab_week":var t=S.filter(function(e){var t=p(e.updated_at).format("L");return t>=C&&V>=t}),i={data:t};Ti.App.fireEvent("app:transactionStaticView",i),z(t),k=e;break;case"tab_month":var a=S.filter(function(e){var t=p(e.updated_at).format("L");return t>=O&&E>=t}),i={data:a};Ti.App.fireEvent("app:transactionStaticView",i),z(a),k=e;break;case"tab_all":var i={data:S};Ti.App.fireEvent("app:transactionStaticView",i),z(S),k=e}},200)):alert("No records to fetch")};s.lbl_week.setColor("#F0C60A");var H=function(e){Cloud.Objects.query({classname:"testItems",limit:1e3,where:{$and:[{userId:x.getLastLoggedInUserId()},{updated_at:{$gt:dbOperations.getLatestTransactionDate(x.getLastLoggedInUserId())}}]}},function(t){t.success?(N(),console.log("The length"),console.log(t.testItems.length),t.testItems.length>0&&(dbOperations.saveTransactionRows(t.testItems),Y(e)),D(),l(dbOperations.getAllTransactionRows(x.getLastLoggedInUserId())),T=!1):(D(),B(),T=!0,Y(e))})};Titanium.Network.networkType===Titanium.Network.NETWORK_NONE?(B(),L=1,T=!0,Y("tab_week")):(M(),Y("tab_week"),H(k)),c["$.__views.stickyFooter!click!onTabSelected"]&&s.__views.stickyFooter.addEventListener("click",r),_.extend(s,d)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;